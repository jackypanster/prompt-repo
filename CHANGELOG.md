# Changelog

项目发布历史和重要更新记录。

## [v0.2.0] - 2025-01-26 - 数据库基础设施

### ✅ 新增功能
- **完整的数据库架构**
  - SQLite + WAL模式，优化并发读写
  - 5个核心表：categories, tags, prompts, prompt_tags, prompt_likes
  - 16个优化索引，提升查询性能
  - 外键约束和级联删除机制

- **数据模型与CRUD**
  - SQLAlchemy 2.0 数据模型定义
  - 基础CRUD操作函数
  - 防重复点赞机制（IP哈希）

- **健康检查与监控**
  - `/db-health` 端点实时监控数据库状态
  - WAL模式和外键约束状态检查
  - 表统计信息

### 🔧 技术改进
- 添加SQLAlchemy 2.0和Pydantic依赖
- 添加pytest测试框架
- 11个数据库功能测试覆盖
- 完善的.gitignore配置

### 📝 文档更新
- 更新README.md反映当前架构
- 项目结构文档化
- API端点状态说明

## [v0.1.0] - 2025-01-26 - 项目初始化

### ✅ 基础设施
- **项目框架**
  - FastAPI应用基础框架
  - uv环境管理和依赖配置
  - pyproject.toml项目配置

- **基础端点**
  - `/` 主页欢迎信息
  - `/health` 应用健康检查
  - `/docs` FastAPI自动生成的API文档

### 🏗️ 开发环境
- Python 3.12+ 运行环境
- uv包管理工具集成
- 虚拟环境正确配置
- 应用在端口8080正常运行

---

## 版本规范

- **主版本号 (Major)**: 重大架构变更或不兼容更新
- **次版本号 (Minor)**: 新功能添加或重要模块完成
- **修订号 (Patch)**: Bug修复或小幅改进

## [v0.3.0] - 2025-01-26 - 认证与权限控制

### ✅ 新增功能
- **HTTP Basic Auth认证**
  - 管理员凭证验证（用户名/密码）
  - 防时序攻击的安全比较
  - 环境变量配置支持

- **IP限频防滥用**
  - 可配置的访问频率限制
  - IP地址哈希保护隐私
  - 自动清理过期限频记录
  - 限频状态查询功能

- **认证端点**
  - `/admin` 管理员仪表板（需认证）
  - `/api/test-rate-limit` 限频测试端点
  - 认证失败返回401状态码

### 🔧 技术改进
- 添加httpx测试依赖
- 修复datetime.utcnow()弃用警告
- 8个认证功能测试覆盖
- 全局限频存储管理

### 📝 文档更新
- 更新README.md认证状态
- 更新CHANGELOG.md版本历史

## [v0.4.0] - 2025-01-26 - 模板系统与前端基础设施

### ✅ 新增功能
- **Jinja2模板系统**
  - 完整的模板引擎配置
  - 基础布局模板（base.html）
  - 响应式主页模板（index.html）
  - 模板上下文变量传递

- **静态文件服务**
  - CSS、JavaScript、图片资源服务
  - 自定义样式文件（custom.css）
  - 主要JavaScript功能文件（main.js）
  - 静态文件目录结构

- **前端技术栈集成**
  - Tailwind CSS CDN集成
  - Alpine.js响应式框架
  - 自定义CSS动画和样式
  - 响应式设计支持

- **用户界面**
  - 现代化的主页设计
  - 功能特性展示卡片
  - 平台状态实时监控
  - 导航栏和页脚布局

### 🔧 技术改进
- 添加Jinja2和python-multipart依赖
- 修复TemplateResponse弃用警告
- 13个模板系统测试覆盖
- 完整的静态文件测试

### 📝 文档更新
- 更新主页为HTML模板渲染
- 修复认证测试适配新的根端点

## [v0.5.0] - 2025-01-26 - 分类管理模块

### ✅ 新增功能
- **分类管理API端点**
  - `POST /admin/categories` - 创建分类
  - `GET /admin/categories` - 获取分类列表（支持分页、筛选）
  - `GET /admin/categories/{id}` - 获取分类详情
  - `PUT /admin/categories/{id}` - 更新分类
  - `DELETE /admin/categories/{id}` - 删除分类

- **Pydantic模型定义**
  - CategoryCreate, CategoryRead, CategoryUpdate 模型
  - CategoryList 分页响应模型
  - 完整的数据验证和序列化

- **数据库CRUD操作**
  - 支持分页查询和计数
  - 分类名唯一性约束
  - 删除时检查关联的提示词
  - 部分更新支持

- **认证与权限控制**
  - 所有管理端点需要HTTP Basic Auth认证
  - 完整的错误处理和响应格式

### 🔧 技术改进
- 扩展数据库模型，添加is_active字段
- 更新Category、Tag、Prompt模型结构
- 20个完整的集成测试覆盖
- 命令行测试验证所有端点

### 📝 验收完成
- ✅ Pydantic模型定义完整
- ✅ 集成测试：所有CRUD操作、认证访问、唯一性约束、关联检查
- ✅ 命令行测试：curl验证所有管理端点（带认证）

## [v0.7.0] - 2025-01-26 - 提示词管理模块

### ✅ 新增功能
- **提示词管理API端点**
  - `POST /admin/prompts` - 创建提示词（支持分类和标签关联）
  - `GET /admin/prompts` - 获取提示词列表（分页、筛选、排序）
  - `GET /admin/prompts/{id}` - 获取提示词详情
  - `PUT /admin/prompts/{id}` - 更新提示词（部分更新支持）
  - `DELETE /admin/prompts/{id}` - 删除提示词及关联数据

- **提示词数据模型**
  - PromptCreate, PromptUpdate, PromptRead, PromptList 模型
  - 完整的数据验证和序列化
  - 字段映射处理（content/content_markdown）

- **高级筛选功能**
  - 支持按分类ID筛选
  - 支持按标签ID筛选
  - 支持按精选状态筛选
  - 支持按激活状态筛选
  - 分页和排序功能

- **标签关联管理**
  - 支持多标签关联
  - 动态更新标签关系
  - 标签关联数据自动加载
  - 关联数据完整性检查

- **认证与权限控制**
  - 所有管理端点需要HTTP Basic Auth认证
  - 完整的错误处理和响应格式
  - 统一的HTTP状态码返回

### 🔧 技术改进
- **数据库模型扩展**: Prompt模型添加content属性映射
- **CRUD操作增强**: 提示词CRUD支持复杂关联关系处理
- **API路由注册**: 主应用集成提示词管理路由
- **错误处理优化**: 统一的HTTP状态码和错误响应格式
- **字段映射解决**: 解决content/content_markdown字段映射问题

### 📝 验收完成
- ✅ Pydantic模型定义完整
- ✅ 集成测试：24个测试用例全部通过
  - 认证保护测试（4个）
  - CRUD操作测试（14个）
  - 数据验证测试（3个）
  - 关联功能测试（3个）
- ✅ 命令行测试：完整的curl测试脚本验证所有端点

## [v0.6.0] - 2025-01-26 - 标签管理模块

### ✅ 新增功能
- **标签管理API端点**
  - `POST /admin/tags` - 创建标签
  - `GET /admin/tags` - 获取标签列表（支持分页、筛选）
  - `GET /admin/tags/{id}` - 获取标签详情
  - `PUT /admin/tags/{id}` - 更新标签
  - `DELETE /admin/tags/{id}` - 删除标签

- **标签颜色管理**
  - 支持十六进制颜色值设置
  - 默认颜色值（#3b82f6）
  - 颜色值验证（最大7字符）
  - 自定义颜色功能

- **Pydantic模型扩展**
  - TagCreate, TagRead, TagUpdate 模型完善
  - TagList 分页响应模型
  - 完整的数据验证和序列化

- **数据库CRUD操作增强**
  - 支持分页查询和计数
  - 标签名唯一性约束
  - 删除时检查关联的提示词
  - 使用次数统计功能
  - 部分更新支持

- **认证与权限控制**
  - 所有管理端点需要HTTP Basic Auth认证
  - 完整的错误处理和响应格式

### 🔧 技术改进
- 扩展CRUD操作支持标签管理
- 22个完整的集成测试覆盖
- 命令行测试验证所有端点
- 支持激活状态筛选功能

### 📝 验收完成
- ✅ Pydantic模型定义完整
- ✅ 集成测试：所有CRUD操作、认证访问、唯一性约束、关联检查、颜色功能
- ✅ 命令行测试：curl验证所有管理端点（带认证）

## 下一版本预览

### v0.7.0 - 提示词管理模块 (开发中)
- 提示词管理API端点
- 提示词CRUD操作
- 标签关联管理 